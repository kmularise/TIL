# 서블릿(Servlet)

## 특징
```java
@WebServlet(name = "helloServlet", urlPatterns = "/hello")
public class HelloServlet extends HttpServlet {
    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) {
        //애플리케이션 로직
    }
}
```
* urlPatterns(/hello)의 URL이 호출되면 서블릿 코드가 실행
* HTTP 요청 정보를 편리하게 사용할 수 있는 HttpServletRequest
* HTTP 응답 정보를 편리하게 사용할 수 있는 HttpServletResponse
* 개발자는 HTTP 스펙을 매우 편리하게 사용

## HTTP 요청, 응답 흐름
![image](https://github.com/kmularise/TIL/assets/106499310/8d9629b4-d2cd-4c53-a032-80c5891fb7f1)
HTTP 요청 시,
* WAS는 Request, Response 객체를 새로 만들어서 서블릿 객체 호출
* 개발자는 Request 객체에서 HTTP 요청 정보를 편리하게 꺼내서 사용
* 개발자는 Response 객체에 HTTP 응답 정보를 편리하게 입력
* WAS는 Response 객체에 담겨 있는 내용으로 HTTP 응답 정보 생성

## 서블릿 컨테이너
![image](https://github.com/kmularise/TIL/assets/106499310/bc5bce95-82bb-4e73-a7f3-0ec87aeeae2c)

* 톰캣처럼 서블릿을 지원하는 WAS를 서블릿 컨테이너라고 한다.
* 서블릿 컨테이너는 서블릿 객체를 생성, 초기화, 호출, 종료하는 생명주기 관리
* 서블릿 객체는 싱글톤으로 관리
    * 요청이 올 때 마다 객체를 생성하는 것은 비효율 적이다.
    * 최초 로딩 시점에 서블릿 객체를 미리 만들어두고 재활용
    * 모든 요청은 동일한 서블릿 객체 인스턴스에 접근
    * 공유 변수 사용 시 주의해야 한다.
    * 서블릿 컨테이너 종료 시 함께 종료
* JSP도 서블릿으로 변환된어서 사용
* **동시 요청을 위한 멀티 스레드 처리 지원**


## 일반적인 서블릿 개발 과정
1. 서블릿 규약에 따라 자바 코드를 작성한다.
2. 자바 코드를 컴파일해서 클래스 파일을 생성한다.
3. /WEB-INF/classes 폴더에 클래스 파일을 패키지에 알맞게 위치시킨다.
4. web.xml 파일에 서블릿 클래스를 설정한다.
5. 톰캣 등의 컨테이너를 실행한다.
6. 웹 브라우저에서 확인한다.

## 서블릿 등록
* 서블릿으로 사용할 클래스
* 서블릿과 URL 간의 매핑
    서블릿 2.5 버전까지는 web.xml 파일에 서블릿으로 등록해야 서블릿 클래스를 사용할 수 있었는데, 서블릿 3.0 버전부터는 @WebServlet 어노테이션을 사용하면 서블릿으로 등록된다.
    * web.xml 파일에서 등록
    * 어노테이션 사용해서 등록 : web.xml 처럼 복잡하게 여러 태그로 설정하지 않아도 된다는 장점이 있다.
    URL 경로가 변경될 때, web.xml 파일을 사용하면 web.xml 파일만 변경하면 된다. 어노테이션을 사용하는 경우, urlPatterns 속성값을 변경하고 다시 컴파일해야 한다. 따라서 URL이 빈번하게 변경될 경우, web.xml 파일을 사용하는 것이 적절해 보인다.
```
@WebServlet 어노테이션이 적용된 서블릿을 web.xml 파일에 등록하게 되면 어떻게 될까?
이 경우 @WebServlet 어노테이션에 적용된 URL 패턴과 web.xml 파일에 등록된 URL 패턴에 모두 매핑된다. @WebServlet 어노테이션이 적용된 클래스 객체가 생성되고 web.xml 파일에서 지정한 클래스 객체가 생성된다. 즉, 서로 다른 두개의 객체가 생성된다.
```

## 서블릿 로딩과 초기화
![image](https://github.com/kmularise/TIL/assets/106499310/9dd3b0b6-cb23-48b7-b91f-63ea1194c7f8)
* 서블릿 컨테이너는 처음 서블릿을 실행할 때 서블릿 객체를 생성한다.
* 서블릿을 최초 요청할 때 서블릿 객체를 생성하고 이후 요청이 오면 앞서 생성한 서블릿 객체를 그대로 사용한다.
* 서블릿 로딩 : 웹 컨테이너가 서블릿 객체를 생성하고 init() 메소드를 호출하는 과정
* 초기화 작업 : 서블릿은 init() 메소드를 이용해서 필요한 초기화 작업을 수행한다. 초기화 작업은 상대적으로 시간이 오래 걸리기 때문에 웹 컨테이너를 처음 구동하는 시점에 초기화를 진행하는 것이 좋다.

## 초기화 파라미터
JDBC 드라이버 클래스 이름, JDBC URL, DB 사용자 정보와 같이 초기에 설정하는 값들을 설정파일 web.xml의 초기화 파라미터를 변경하는 방법으로 변경할 수 있다. 코드를 직접 변경하지 않고 초기 값들을 변경하고 소스코드 상에서 초기값들을 읽을 수 있다. 어노테이션으로도 동일하게 할 수 있으나 초기화 설정을 변경해야 할 때마다 자바 코드를 수정해야 하기 때문에 변경의 유연함을 떨어뜨린다.

## URL 패턴 매칭 규칙
* '/'로 시작하고 '/*'로 끝나는 url-pattern 은 경로 매핑을 위해서 사용한다.
* '*.'로 시작하는 url-pattern은 확장자에 대한 매핑을 할 때 사용한다.
* 오직 '/'만 포함하는 경우 애플리케이션의 기본 서블릿으로 매핑한다.
* 이 규칙 외, 나머지 다른 문자열은 정확한 매핑을 위해서 사용한다.
_______________
## 비동기 서블릿 
* 서블릿을 비동기로 처리하는 방식
### 기존 서블릿
* Servlet 3.0 전의 기존 서블릿은 클라이언트가 요청할 시, 쓰레드를 생성한 후 서블릿이 모두 처리되고 나면 쓰레드를 반환하는 방식이었다.
* 이로 인해 서블릿 수행시간이 길어져 쓰레드 점유율이 높아졌고, 쓰레드 풀에 사용할 수 있는 쓰레드가 없으면 더이상 요청을 처리할 수 없는 상태가 된다.
* 이는 애플리케이션의 실행 속도를 늦추기에, 이를 보완하고자 비동기 서블릿이 생겼다.
### 비동기 서블릿
* 모든 요청이 처리될때까지 대기하는 쓰레드 없이 쓰레드를 한 작업에 사용하면 반환하고, 필요 시 다른 쓰레드를 다시 사용하고 반납한다.
* 비동기 방식은 쓰레드가 응답이 완료될 때까지 기다릴 필요가 없기에 쓰레드는 다른 요청을 처리할 수 있게 되어 불필요한 쓰레드 점유가 없다.
___________________
## 인텔리제이 프로젝트 설정
https://suyeonchoi.tistory.com/33 참고

## 참고 자료
https://sarc.io/index.php/development/1609-asynchronous-servlet
