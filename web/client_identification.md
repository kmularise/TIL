# 클라이언트 식별
* 웹 서버는 서로 다른 여러개의 클라이언트와 동시에 통신한다. 웹 서버는 클라이언트로부터 받는 모든 요청을 처리해야할 뿐만 아니라 서버와 통신하고 있는 클라이언트를 추적해야 할 수도 있다.

## 개별 접촉
* HTTP는 익명으로 사용하며 상태가 없고 요청과 응답으로 통신하는 프로토콜이다. 서버는 클라이언트가 보낸 요청을 처리하고 나서 그 응답을 클라이언트로 전송한다.
* 웹 서버는 요청을 보낸 사용자를 식별하거나 방문자가 보낸 연속적인 요청을 추적하기 위해 약간의 정보를 이용할 수 있다.

### 개별인사
개인 사용자에게 특화된 환영 메세지나 페이지 내용을 만든다.

### 사용자 맞춤 추천
고객의 생일이나 중요한 날이 다가오면 특별한 맞춤 제품을 제시한다.

### 저장된 사용자 정보
쇼핑을 더 편하게 할 수 있도록 저장된 사용자 정보를 사용한다.

### 세션 추적
* HTTP 트랜잭션은 상태가 없다. 각 요청에 독립적으로 일어난다.
* 많은 웹사이트에서 사용자가 사이트와 상호작용할 수 있게 사용자의 상태를 남긴다. (장바구니 기능 등)
* 이렇게 상태를 유지하려면, 웹 사이트는 각 사용자에게서 오는 HTTP 트랜잭션을 식별할 방법이 필요하다.

## HTTP 사용자를 식별하는 기술
사용자에 대한 정보를 전달하는 가장 일반적인 일곱 가지 HTTP 요청 헤더

### 사용자 식별 관련 정보를 전달하는 HTTP 헤더들
사용자에 대한 정보를 전달하는 가장 일반적인 일곱가지 HTTP 요청 헤더
| 헤더 이름 | 헤더 타입	| 설명 |
| --------- | --------- | --------- |
| From | 요청 | 사용자의 이메일 주소 |
| User-Agent | 요청 | 사용자의 브라우저 |
| Referer | 요청 | 사용자가 현재 링크를 타고 온 근원 페이지 |
| Authorization | 요청 | 사용자의 이름과 비밀번호(뒤에서 다룸, 발전된 헤더) |
| Client-ip | 확인(요청) | 클라이언트이 IP주소 |
| X-Forwarded-For | 확인(요청) | 클라이언트의 IP주소 |
| Cookie | 확인(요청) |서버가 생성한 ID 라벨 |
* From
    * 사용자의 이메일 주소를 포함한다. 이상적으로는 각 사용자가 서로 다른 이메일 주소를 가지므로, From 헤더로 사용자를 식별할 수 있다.
    * 악의적인 서버가 이메일 주소를 모아서 스팸 메일을 발송하는 문제가 있어서 From 헤더를 보내는 브라우저는 많지 않다.

* User-Agent
    * 사용자가 쓰고 있는 브라우저의 이름과 버전 정보, 어떤 경우에는 운영체제에 대한 정보까지 포함하여 서버에게 알려준다.
    * 이는 특정 브라우저에서 제대로 동작하도록 그것들의 속성에 맞추어 콘텐츠를 최적화하는 데 유용할 수 있지만, 특정 사용자를 식별하는 데는 크게 도움되지 않는다.
* Referer
    * 사용자가 현재 페이지로 유입하게 한 웹페이지의 URL을 가르킨다.
    * Referer헤더 자체만으로 사용자를 식별할 순 없지만, 사용자가 이전에 어떤 페이지에 방문했었는지 알려준다.
    * 사용자의 웹 사용 행태나 사용자의 취향을 더 잘 파악할 수 있다.
[결론]
From, User-Agent, Referer 헤더들은 확실히 식별하기에는 부족한 정보를 가진다.
### 클라이언트 IP 주소
* 클라이언트의 IP 주소를 사용하는 방식은 사용자가 확실한 IP 주소를 갖고있고, IP 주소가 잘 바뀌지 않고, 웹 서버가 요청마다 클라이언트의 IP 주소를 알 수 있을 때 클라이언트를 식별할 수 있다.
* 클라이언트의 IP 주소는 보통 HTTP 헤더에 없지만 웹 서버는 HTTP 요청을 보내는 TCP 커넥션의 반대쪽 IP를 알아낼 수 있다.

[클라이언트 IP 주소로 클라이언트를 식별하는 방법의 약점]
* 동일한 IP 주소 환경에서 여러 브라우저가 요청을 보낼 경우, 클라이언트를 식별할 수 없다.
* 많은 ISP는 사용자가 로그인하면 동적으로 IP를 할당한다. 시간에 따라 IP 주소가 변하게 되는데 클라이언트 식별에 어려움이 있을 수 있다.
* NAT는 클라이언트의 실제 IP 주소를 방화벽 뒤에 숨기고, 클라이언트의 실제 IP 주소를 내부에서 사용하는 방화벽 IP 주소로 변환하여 실제 IP 주소를 방화벽 뒤로 숨긴다.
* HTTP 프록시와 게이트웨이는 원래 서버에 새로운 TCP를 연결한다. 이때, 웹 서버는 클라이언트의 IP 주소 대신 프록시의 IP주소를 본다. 일부 프록시는 클라이언트의 IP 주소를 보존하기 위해 Client-Ip나 X-Forward-For HTTP 같은 헤더를 사용하지만 모든 프록시가 이런식으로 동작하진 않는다.

```
NAT (Network Address Translation) : 네트워크 주소 변환기
1. 공공망과 연결되는 사용자들의 고유한 사설망을 공격자들로부터 보호하기 위해 사용
2. 인터넷의 공인 IP주소를 절약하고자 하는 목적으로 사용
```

### 사용자 로그인 
* IP 주소로 사용자를 식별하려는 수동적인 방식보다, 웹 서버는 사용자 이름과 비밀번호로 인증할 것을 요구해서 사용자에게 명시적으로 식별 요청 한다.

[로그인 단점]
* 사용자는 매번 로그인할 때마다 아이디와 비밀번호를 기억해야 한다.

### 쿠키
* [쿠키 동작 방식 참고](./Cookie_Session.md#%EC%BF%A0%ED%82%A4-%EB%8F%99%EC%9E%91-%EB%B0%A9%EC%8B%9D-%EC%9B%B9-%EC%84%9C%EB%B2%84-%EC%83%9D%EC%84%B1-%EA%B8%B0%EC%A4%80) 

[쿠키 단점]
* 보안에 취약하다.
    * 요청 시 쿠키의 값을 그대로 보낸다.
    * 유출 및 조작 당할 위험이 존재한다.

### 브라우저 지문
* 브라우저 지문은 웹사이트에서 브라우저와 운영체제의 고유 기능을 수집하고 결합하여 특정 브라우저(더 나아가 특정 사용자)를 식별하는 관행이다. 다음과 같은 요소들이 포함될 수 있다.
* 브라우저 버전
* 시간대 및 기본 언어
* 시스템에서 사용할 수 있는 비디오 또는 오디오 코덱 세트
* 시스템에 설치된 글꼴
* 브라우저 설정 상태
* 컴퓨터의 디스플레이 크기 및 해상도

웹사이트는 디바이스에서 JavaScript 및 CSS 를 실행하여 이와 같은 정보를 검색할 수 있으며, 이 데이터를 결합하여 브라우저에 대한 고유한 지문을 생성할 수 있다. 또한 이를 통해 웹에서 사용자를 추적할 수 있다.

## 참고자료
* HTTP 완벽가이드 11장
* https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication
* https://kim-dragon.tistory.com/10#:~:text=%EB%A8%BC%EC%A0%80%20NAT%EA%B0%80%20%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C%EC%9A%94,%EB%A1%9C%20%EB%B3%80%ED%99%98%ED%95%B4%EC%A3%BC%EA%B8%B0%EB%8F%84%20%ED%95%A9%EB%8B%88%EB%8B%A4.
* https://tecoble.techcourse.co.kr/post/2021-05-22-cookie-session-jwt/
