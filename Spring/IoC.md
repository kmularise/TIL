# 제어의 역전(IoC)

## 팩토리
* 객체의 생성 방법을 결정하고 생성된 객체를 반환
    * cf) 추상 팩토리 패턴이나 팩토리 메소드 패턴과는 다르다.
* 오브젝트를 생성하는 쪽과 생성된 오브젝틀틀 사용하는 쪽의 역할과 책임을 분리하려는 목적으로 사용
* 컴포넌트 : 실질적인 로직 담당 - UserDao, ConnectionMaker
* 설계도 : 애플리케이션을 구성하는 컴포넌트 구조와 관계 정의
    * 어떤 오브젝트가 어떤 오브젝트를 사용하는지 정의 - DaoFactory
    * 애플리케이션 컨텍스트와 설정정보

![image](https://github.com/kmularise/TIL/assets/106499310/9ce246fb-5e38-405d-ad24-d07f5031e819)

* DaoFactory를 분리했을 때 얻을 수 있는 장점
    * 애플리케이션 컴포넌트 역할을 하는 오브젝트와 애플리케이션 구조를 결정하는 오브젝트를 분리

## 제어의 역전
* 프로그램의 제어 흐름 구조가 뒤바뀌는 것
* 일반적으로 프로그램의 흐름은 프로그램 시작 시점에 다음 사용할 오브젝트를 결정하고, 생성하고, 메소드를 호출하는 과정의 반복이다.
* 제어의 역전에서는 오브젝트가 자신이 사용할 오브젝트를 스스로 선택하거나 생성하지 않는다. 또한 자신도 어떻게 만들어지고 어디서 사용되는지 알 수 없다. 모든 제어 권한을 자신이 아닌 다른 대상에게 위임하여 제어 권한을 위임받은 오브젝트에 의해 결정되고 만들어진다.

### 프레임워크와 라이브러리
* 프레임워크는 애플리케이션 코드를 사용한다. 
    * 프레임워크 위에 개발한 클래스를 등록해두고, 프레임워크가 흐름을 주도하는 중에 애플리케이션 코드를 사용한다.
    * 프레임워크에는 제어의 역전 개념이 적용되어 있다.
    * 애플리케이션 코드는 프레임워크가 짜놓은 틀에서 수동적으로 동작한다.
* 라이브러리를 사용하는 애플리케이션 코드는 애플리케이션 흐름을 직접 제어한다.

* IoC 컨테이너, IoC 프레임워크 : 제어의 역전에서는 프레임워크 또는 컨테이너와 같이 애플리케이션 컴포넌트의 생성과 관계설정, 사용, 생명주기 관리 등을 주관하는 존재가 필요하다.

## 스프링의 IoC

### 빈(Bean)
* 스프링에서는 스프링이 제어권을 가지고 직접 생성하고 관계를 부여하는 오브젝트를 빈이라고 부른다. 
* 자바빈과 유사하게 오브젝트 단위의 애플리케이션 컴포넌트를 말하며 스프링 컨테이너가 생성과 관계설정, 사용 등을 제어해주는 제어의 역전이 적용된 오브젝트를 가리킨다.
* @Bean이나 @Component와 같은 어노테이션이 붙어 있지 않은 new로 생성된 일반적인 자바 객체는 스프링 빈에 해당하지 않는다.

### 스프링 IoC 컨테이너 / 스프링 컨테이너
* 스프링 컨테이너 : 스프링 빈(Bean)의 생성과 소멸 등의 생명주기를 관리하고, 기능을 제공하며 IoC를 이용하여 애플리케이션 컴포넌트를 관리한다.

스프링 컨테이너에는 두가지 종류가 있다. 
1. 빈 팩토리 Bean Factory : 빈을 생성하고 관계를 설정하는 IoC의 기본 기능에 초점을 맞췄다.
2. 애플리케이션 컨텍스트 Application Context : 애플리케이션 전반에 걸쳐 모든 구성요소의 제어 작업을 담당하는 IoC 엔진

애플리케이션 컨텍스트는 IoC 방식에 따라 만들어진 일종의 빈 팩토리이다. 

애플리케이션 컨텍스트는 설정정보를 참고해서 빈의 생성, 관계 설정 등의 제어 작업을 총괄한다. 애플리케이션 컨텍스트는 직접 정보를 담고 있지는 않지만 별도로 설정 정보를 가져와 활용하는 범용적인 IoC 엔진이다. 그 자체로는 애플리케이션 로직을 담당하지는 않지만 IoC 방식을 이용해 애플리케이션 컴포넌트를 생성하고, 사용할 관계를 맺어준다.

```java
@Configuration // 애플리케이션 컨텍스트 또는 빈 팩토리가 사용할 설정정보
public class DaoFactory {
    @Bean // 오브젝트 생성을 담당하는 IoC 용 메소드라는 표시
    public UserDao userDao() {
        return new UserDao(connectionMaker());
    }
    @Bean
    public ConnectionMaker connectionMaker() {
        return new DConnectionMaker();
    }
} 
```
DaoFactory는 자바 코드로 되어 있지만 XML과 같은 스프링 전용 설정정보라고 생각하면 된다.

애플리케이션 컨텍스트는 ApplicationContext 인터페이스를 구현하는데, ApplicationContext는 빈 팩토리가 구현하는 BeanFactory 인터페이스를 상속했으므로 애플리케이션 컨텍스트는 일종의 빈 팩토리이다. 

## 애플리케이션 컨텍스트 동작 방식

![image](https://github.com/kmularise/TIL/assets/106499310/cbfbc8af-dff4-4462-96f3-3ab979ad38ea)

1. 애플리케이션 컨텍스트는 DaoFactory 클래스를 설정정보로 등록해두고 @Bean이 붙은 메소드 이름을 가져와 빈 목록을 만들어둔다.
2. 클라이언트가 애플리케이션 컨텍스트의 getBean() 메소드를 호출하면 자신의 빈 목록에서 요청한 이름이 있는지 찾는다.
3. 해당 빈이 있다면 빈을 생성하는 메소드를 호출해서 오브젝트를 생성시킨 후 클라이언트에 돌려준다.

## 애플리케이션 컨텍스트의 장점
* 클라이언트는 구체적인 팩토리 클래스를 알 필요가 없다.
* 애플리케이션 컨텍스트는 종합 IoC 서비스를 제공해준다.
    * 오브젝트 생성 방식, 시점과 전략을 다르게 가져갈 수도 있고, 이에 부가적으로 자동 생성, 오브젝트에 대한 후처리, 정보의 조합, 설정 방식의 다변화, 인터셉팅 등 오브젝트를 효과적으로 활요할 수 있는 다양한 기능 제공
    * 빈이 사용할 수 있는 기반기술 서비스나 외부 시스템과의 연동 등을 컨테이너 차원에서 제공해주기도 한다.
* 애플리케이션 컨텍스트는 빈을 검색하는 다양한 방법을 제공한다.
    * 타입만으로 빈 검색, 애노테이션 설정이 되어 있는 빈 검색