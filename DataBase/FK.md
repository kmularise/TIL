# FOREIGN KEY 제약 사용시 장단점

## FK를 설정하는 이유
1. 데이터 정합성 문제를 해결할 수 있다.
외래키 없이도 애플리케이션단 코드를 통해 지킬 수 있지만 DB에 직접 접근하여 수동으로 데이터를 바꾸는 경우도 있다. 이로 인해 데이터 정합성이 깨질 가능성이 있다.

2. 스키마를 통해 각 테이블 간 관계를 명확히 알 수 있다.
외래키가 지정되어 있지 않다면 애플리케이션단 코드를 보며 파악하거나 문서를 통해 파악해야 한다. 애플리케이션 코드에 ORM이 사용되지 않았다면 코드에서도 테이블간 관계를 명시적으로 확인하기 힘들다.


## FK를 설정하지 않는 이유
1. FK에 따른 데이터 소실우려
하위 테이블을 구성하다면 FK를 연결하는 경우가 많다. 복잡하게 구성된 상위 테이블 중에서 단 하나의 데이터만이라도 수정/변경되면 의도지 못하게 하위 테이블의 데이터가 변경되는 경우가 있다.

2. 임의의 데이터 삽입의 번거로움
하위 테이블에서 입의 데이터를 삽입하고자 할 때 CASCADE 설정 시 반드시 상위 테이블도 추가해줘야 한다.
외래키의 참조 무결성 제약사항으로 부모 - 자식 관계에서 자식 테이블의 row를 추가할 시 자식이 외래키로 참조하고 있는 부모 테이블의 row가 있어야 DML 작업이 가능하다.

다만 외래키를 Deferred 옵션으로 만들면 해결 가능하다.
Deferred는 Validation 검사를 트랜잭션 단위로 한다는 뜻이다.

https://engineering-skcc.github.io/oracle%20tuning/foreign_key_%EC%97%86%EC%9D%B4_%EA%B5%AC%EC%B6%95%ED%95%98%EB%8A%94_DB/

3. Insert Query 속도 저하
FK가 설정된 table에서 Insert Query시 약간의 속도저하가 있다.

4. 기존 레거시 데이터의 정합성이 맞지 않다.
기존 데이터의 정합성이 맞지 않아 외래키를 추가 하려고 해도 제약조건이 걸려서 추가가 힘들다. 
옵션을 통해 제약사항을 잠시 껐다가 다시 키는 방법을 통해 해결할 수 있다.
https://engineering-skcc.github.io/oracle%20tuning/foreign_key_%EC%97%86%EC%9D%B4_%EA%B5%AC%EC%B6%95%ED%95%98%EB%8A%94_DB/