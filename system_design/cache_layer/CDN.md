# 콘텐츠 전송 네트워크(CDN)
## CDN 정의
* 정적 콘텐츠를 전송하는데 쓰이는, 지리적으로 분산된 서버의 네트워크
* 이미지, 비디오, css, java script 파일 등을 캐시할 수 있다.

## CDN 동작과정
* 사용자가 웹사이트를 방문하면, 그 사용자에게 가장 가까운 CDN 서버가 정적 콘텐츠를 전달하게 된다.
* 사용자가 CDN 서버로부터 멀수록 웹사이트는 천천히 로드된다.
![cdn동작](https://github.com/kmularise/TIL/assets/106499310/76700d99-e813-48be-aa2c-20f8b6c92482)
1. 사용자 A가 이미지 URL을 이용해 image.png에 접근한다. URL 도메인은 CDN 서비스 사업자가 제공한 것이다.
2. CDN 서버의 캐시에 해당 이미지가 없는 경우, 서버는 원본(origin) 서버에 요청하여 파일을 가져온다. 원본서버는 웹 서버일 수도 있고 아마존 S3 같은 온라인 저장소일 수도 있다.
3. 원본 서버가 파일을 CDN 서버에 반환한다. 응답의 HTTP 헤더에 해당 파일이 얼마나 오래 캐시될 수 있는지 설명하는 TTL(Time-To-Live) 값이 들어 있다.
4. CDN 서버는 파일을 캐시하고 사용자 A에게 반환한다. 이미지는 TTL에 명시된 시간이 끝날 때까지 캐시된다.
5. 사용자 B가 같은 이미지에 대한 요청을 CDN 서버에 전송한다.
6. 만료되지 않은 이미지에 대한 요청은 캐시를 통해 처리된다.

## CDN 사용 시 고려 사항
### 비용 
* CDN은 제 3사업자에 의해 운영, CDN으로 들어가고 나가는 데이터 전송 양에 따라 요금이 결정된다. 자주 사용되는 콘텐츠에 한해 캐싱하는 것이 효율적이다.
### 만료 기한 설정
* 시간에 민감한(time-sensitive) 콘텐츠의 경우 만료 시점을 잘 정해야 한다. 너무 길면 콘텐츠의 신선도가 떨어지고, 너무 짧으면 원본 서버와 빈번히 접속하게 되어 좋지 않다.
### CDN 장애
* 일시적으로 CDN이 응답하지 않을 경우, 해당 문제를 감지하여 원본 서버로부터 직접 콘텐츠를 가져오도록 클라이언트를 구성할 필요가 있다.
### 콘텐츠 무효화
* 만료되지 않은 콘텐츠를 CDN에서 제거할 수 있는 방법
    1. CDN 서비스 사업자가 제공하는 API 이용하여 콘텐츠 무효화
    2. 콘텐츠의 다른 버전을 서비스하도록 오브젝트 버저닝 이용 
    `ex) image.png?v=2`
### CDN 장점
정적 콘텐츠는 더 이상 웹서버를 통해 서비스하지 않으며, CDN을 통해 제공하여 더 나은 성능을 보장한다.
