# 기본키 매핑

## 기본 키 생성 전략
* 직접 할당: 기본 키를 애플리케이션에서 직접 할당, @Id만 사용
* 자동 생성(GeneratedValue): 대리 키 사용 방식
* IDENTITY: 기본 키 생성을 데이터베이스에 위임한다.
* SEQUENCE: 데이터베이스 시퀀스를 사용해서 기본 키를 할당한다. 

## IDENTITY
* IDENTITY는 기본 키 생성을 데이터베이스에 위임하는 전략
* 주로 MySQL, PostgreSQL, SQL Server, DB2에서 사용
* IDENTITY 전략은 데이터베이스에 값을 저장하고 나서야 기본 키 값을 구할 수 있을 때 사용

> 엔티티가 영속 상태가 되려면 식별자가 반드시 필요하다.
> IDENTITY 식별자 생성 전략은 엔티티를 데이터베이스에 저장해야 식별자를 구할 수 있으므로 em.persist()를 호출하는 즉시 INSERT SQL이 데이터베이스에 전달된다.
> IDENTITY 전략은 먼저 엔티티를 데이터베이스에 저장한 후 식별자를 조회해서 엔티티 식별자에 할당한다.
> 트랜잭션을 지원하는 쓰기 지연이 동작하지 않는다.

## SEQUENCE
* 시퀀스는 유일한 값을 순서대로 생성하는 특별한 데이터베이스 오브젝트

> SEQUENCE 전략은 em.persist()를 호출할 때 먼저 데이터베이스 시퀀스를 사용해서 식별자를 조회한다.
> 조회한 식별자를 엔티티에 할당한 후에 엔티티를 영속성 컨텍스트에 저장
> 트랜잭션을 커밋해서 플러시가 일어나면 엔티티를 데이터베이스에 저장한다.
