# 낙관적 락과 비관적 락

데이터베이스에 대한 동시 접근을 적절하게 관리하는 것은 중요하다.
이를 위해 여러 트랜잭션에 대해 에러 없이 처리해야 한다. 또한 동시 읽기 및 쓰기에서 데이터가 일관되게 유지되도록 해야 한다.

## Java Persistence API가 제공하는 낙관적 락
낙관적 락은 버전 정보를 확인하여 엔터티의 변경 사항을 감지한다.
* 낙관적 락을 적용하기 위해 @Version 어노테이션 사용
* 각 트랜잭션이 데이터를 읽기 시작하면 엔티티 버전 정보를 저장한다.
* 트랜잭션이 수정을 시도하면, 엔티티 버전 정보를 다시 확인한다.
    * 그동안 버전 정보가 바뀌었다면 OptimisticLockException이 발생한다.
    * 버전 정보가 동일하면 트랜잭션은 커밋되고 버전 정보를 증가시킨다.
* 수정보다 읽기 작업이 많은 애플리케이션에 적합하다.
* 엔티티가 detached되어야 하거나 락을 일정 시간동안 유지할 수 없을 때 유용하다.

### @Version
* @Version이 적용될 수 있는 타입은  int , Integer , long , Long , short , Short , java.sql.Timestamp 중 하나여야 한다.
* 엔터티를 통해 버전 속성의 값을 검색할 수 있다. 하지만 이를 수정하거나 증가시키면 안 된다.

```java
@Entity
public class Board {
	
    ... 
    
    @Version
    private Integer version;
    
}
```

## 비관적 락
데이터베이스 수준에서 락을 제공한다.
* 각 트랜잭션은 데이터에 대한 락을 획득할 수 있다. 락을 유지하는 한 어떤 트랜잭션도 락이 걸린 데이터를 읽거나 수정할 수 없다.
* 비관적 락은 교착 상태가 발생할 수 있다.
* 그러나 낙관적 락보다 더 높은 데이터 무결성을 보장한다.

<!-- https://devbksheen.tistory.com/227 -->
## 참고자료
https://www.baeldung.com/jpa-optimistic-locking